import Letter from "./Letter";
import GameRouter from "../component/GameRouter";
import type GameSystem from "./GameSystem";
import System from "../../class/System";

import type { GameConfig } from "../../utils/types";
import type { Challenge } from "../../utils/interfaces";

class StringGame extends System{

    private gameRouter: GameRouter;
    private gameSystem: GameSystem;

    private challenges: Challenge[] = [];  
    // private letters: Array<Letter> = [];	
    private gameConfig: GameConfig;
    private i1: number = 0;
    private i: number = 0;

    constructor(gameRouter: GameRouter, gameSystem: GameSystem){
	super();
	this.gameRouter = gameRouter;
	this.gameSystem = gameSystem;
    }

    gameInit(challenges: Challenge[]){
	this.challenges = challenges;
	this.gameRouter.textAudio.system.addAudioSource(this.challenges[this.i1].audioName, this.gameSystem.getType());
	this.gameRouter.textHolder.system.addLetters(challenges);
	this.gameRouter.textHolder.system.displayLetters(this.i1);
	// this.gameRouter.textHolder.system.addLetters(this.letters);
    }

    guessLetter(playerInput: string){
	const currentLetters = this.gameRouter.textHolder.system.challengesLetters[this.i1];
	console.log("currentLetters: ", currentLetters[this.i1]);
	const letter = currentLetters[this.i];
	console.log("letter ", "[", letter.getChar , "]");
	if(letter.getChar === playerInput){
	    letter.turnGreen();
	    console.log("correct!");
	    this.i += 1;
	}else{
	    if(letter.getChar === " "){
		letter.turnBackgroundRed();
	    }else{
		letter.turnRed();
	    }
	    this.gameRouter.textHolder.style.display = "flex";
	    console.log("wrong");
	    this.i += 1;
	}

	if(this.i == this.gameRouter.textHolder.system.challengesLetters[this.i1].length){
	    if(this.i1 != this.challenges.length){
		alert("Line End!");
		this.lineEnd();
	    }else{
		alert("Game End!");
		this.gameEnd();
	    }
	}
    }

    lineEnd(){
	this.i1 += 1;
	this.i = 0;
	this.gameRouter.textAudio.system.addAudioSource(this.challenges[this.i1].audioName, this.gameSystem.getType());
	this.gameRouter.textHolder.system.displayLetters(this.i1);
	console.log("Line ended");
    }

    gameEnd(){
	this.i1= 0;
	console.log("String game finished");
	this.gameRouter.textHolder.system.challengesLetters = [];
	this.gameSystem.gameEnd();
    }

}



export default StringGame;


